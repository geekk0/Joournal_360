{% extends 'base.html' %}
{% load static %}


{% block title %}

    <title>Результаты поиска:</title>

{% endblock %}



{% block content %}

<script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <script type="text/javascript">


    let input_text = '{{ input_text }}'

    $(document).ready(function(){
    Highlight();

    });

    function Highlight() {



        window.find(input_text);

}


    </script>


        <div class="bar">

            <div class="selector-container">

                <form class="selector-filter" action="{% url 'фильтр' %}" method="get">

                    <label>C:</label>
                    <input type="date" name="startdate" value="{{ start_date }}" max="2025-06-04">

                    <label>По:</label>
                    <input type="date" name="stopdate" value="{{ stop_date }}" max="2025-06-04">

                    <label for="author"></label>


                    <label for="tag"></label>
                    <select id="tag" name="tag">

                        <option>{{ tag }}</option>

                        {% for key, value in taglist %}


                            <option content={{ value }}>{{ value }}</option>

                        {% endfor %}

                    </select>


                    <select id="author" name="author">

                        <option value={{ author }}>{{ author_name }}</option>

                        {% for author in group_list %}

                            <option value={{ author.id }}>{{ author }}</option>

                        {% endfor %}
                    </select>

                    <input name="q" type="text" id="box" placeholder={{ input_text }}>

                    <input type="submit" value="Найти">

                    <input type="button" onclick="window.location.href = 'http://127.0.0.1:8000';" value="Очистить"/>
                </form>

            </div>
        </div>


<table class="record_layout">
    <th style="width:15%">Отчет за:</th>
    <th style="width:15%">Теги (проблемы)</th>
    <th style="width:15%">Отправил:</th>
    <th style="width:55%">Текст</th>


    {%  for recs in search_query %}
            <tr>
                <td style="width:15%; text-align: center">{{ recs.report_date }}</td>
                <td style="width:15%; text-align: center">{{ recs.tags }}</td>
                <td style="width:15%; text-align: center">{{ recs.author }}</td>
                {% if input_text == '' %}
                    {% if recs.text|length > 70 %}
                        <td style="width:55%">{{recs.text|truncatechars:300 }}
                        <a href="{% url 'запись' role recs.id  %}">Читать полностью</a>
                    {% else %}
                        <td style="width:60%; min-width: 60%">{{ recs.text }}</td>
                    {% endif %}
                {% else %}
                    <td style="width:60%; min-width: 60%">{{ recs.text }}</td>
                {% endif %}
            </tr>
    {%  endfor %}


</table>

<div class="notes_layout">

    <div>
        {% if role == 'Техдирекция' %}

            <a class="authorization" href="{% url 'добавить заметку инженеров' %}">+</a>
        {% endif %}

        {% if role == 'Режиссеры' %}

            <a class="authorization" href="{% url 'добавить заметку режиссеров' %}">+</a>
        {% endif %}
    </div>

    <p style="text-align: center">Заметки:</p>

    {%  for ns in notes %}
        <ul>
         <li class="notes_meta">{{ ns.created_date }}    {{ ns.author }} <a href="{% url 'удалить заметку' ns.id %}"
         >Удалить</a></li>
         <li class="notes_text">{{ns.message }}</li>
        </ul>

    {%  endfor %}

</div>

{% endblock %}