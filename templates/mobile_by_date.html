{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>Журнал 360</title>
{% endblock %}

{% block content  %}

    <link href="{% static 'css/datepicker.min.css' %}" rel="stylesheet" type="text/css">
    <script src="{% static 'js/datepicker.min.js' %}"></script>


    <div class="template" style="background-image: url({% static 'images/back+logo_3840х2160-01.jpg'%}); background-size: cover">
        <div class="header" style="background-image: url({% static 'images/back+logo_3840х2160-01.jpg'%}); background-size: cover">



                    <div class="add_note">
                        <a class="authorization" href="{% url 'добавить заметку' %}">Начать запись +</a>
                    </div>

                    <div class="logo">

                        <a href="/" >
                            <img src={% static 'images/360_International_white.png'%}>
                        </a>


                    </div>

                    <div class="logout">
                            {% if request.user.is_authenticated %}

                                <p>{{ current_user }}</p>

                            {% endif %}
                    </div>

                    <div class="mobile_menu">
                        <img class="mobile_menu_image" src="{% static 'images/bm.png'%}">


                        <ul class="mobile_menu_list">
                            <li><a href={% url 'по дате мобильный' %}>Найти по дате/тексту</a></li>
                            <li><a href="{% url 'фильтр по отделу мобильный' %}">Отдел/Группа</a></li>
                            <li><a href="{% url 'logout' %}">Выйти</a></li>

                        </ul>
                    </div>

            </div>


    </div>

    <div class="find">

        <div>
            <form name='sdate' class="selector-filter" action="{% url 'найти по дате' %}"
                                  id='datepicker' method="get" style="z-index: 2 !important">

                <input type='text' name='date' id='calendar' class="datepicker-here" data-inline="True"
                                          style="visibility: hidden" />
                <input type="submit" value="Найти" id="submit_button"  style="visibility: hidden" />




            </form>

        </div>

        <script type="application/javascript">

                    document.addEventListener("DOMContentLoaded", init_colors)

                    function init_colors() {
                        let cells = document.getElementsByClassName('datepicker--cell-day')

                        for (let i = 0; i < cells.length; i++) {
                            let day = cells[i].getAttribute('data-date')
                            let month = cells[i].getAttribute('data-month')
                            month = Number(month) + 1
                            month = String(month)
                            if (month.length < 2) {
                                month = '0' + month
                            }
                            if (day.length < 2) {
                                day = '0' + day
                            }
                            let year = cells[i].getAttribute('data-year')
                            let check_date = year + '-' + month + '-' + day

                            let shift_dates_list = {{ shifts_dates|safe }};

                            if (check_date in shift_dates_list) {
                                let shift = shift_dates_list[check_date]
                                color_date(cells[i], shift)

                            }
                            else {
                                console.log(check_date+' даты нет')
                            }
                        }
                        groups_colors()
                    }

                    function color_date(cell, shift) {
                        if (shift === 'shift_4_dates') {
                                cell.style.background = 'rgb(0, 200, 0)' ;
                            }
                        if (shift === 'shift_3_dates') {
                                cell.style.background = 'rgb(200, 0, 0)';
                            }
                        if (shift === 'shift_2_dates') {
                                cell.style.background =  'rgb(0, 160, 255)';
                            }
                        if (shift === 'shift_1_dates') {
                                cell.style.background = 'rgb(200, 200, 0)';
                            }
                    }

                    function groups_colors() {
                        let groups = document.querySelectorAll('ul#group_author > li')

                        for (let i = 0; i < groups.length; i++) {
                            let group_link = groups[i].querySelector('a')
                            if (group_link.innerText === 'Смена Астахова' || group_link.innerText === 'IT Захаров')  {
                                group_link.style.color = 'rgb(200, 200, 0)'
                                console.log('shift found')
                            }
                            if (group_link.innerText === 'Смена Черпакова'|| group_link.innerText === 'IT Дмитриевский') {
                                group_link.style.color = 'rgb(0, 160, 255)'
                                console.log('shift found')
                            }
                            if (group_link.innerText === 'Смена Рославцева'|| group_link.innerText === 'IT Деев') {
                                group_link.style.color = 'rgb(200, 0, 0)'
                                console.log('shift found')
                            }
                            if (group_link.innerText === 'Смена Бороздина'|| group_link.innerText === 'IT Крутихин') {
                                group_link.style.color = 'rgb(0, 200, 0)'
                                console.log('shift found')
                            }
                        }

                    }


                    window.onload = function() {

                        let el = document.getElementById('datepick');
                        console.log(el)
                        el.addEventListener("click", delay);

                        let elem = document.getElementsByClassName('datepicker--nav')[0]
                        elem.addEventListener("click", init_colors)


                    }

                    function delay(el) {
                        console.log(el)
                        setTimeout(send_date, 0.5);
                    }

                    function send_date() {
                        document.forms['sdate'].submit()
                    }
                    </script>

        <div >
            <form class="selector-filter" action="{% url 'найти по тексту' %}" method="get">
                                    <input name="q" type="text" id="textbox" placeholder="В тексте...">
                                    <br>
                                    <input id="search_text" type="submit" value="Найти">
            </form>
        </div>
    </div>

{% endblock %}